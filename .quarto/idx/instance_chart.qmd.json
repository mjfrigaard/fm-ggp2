{"title":"Instance chart","markdown":{"headingText":"Instance chart","headingAttr":{"id":"sec-instance-charts","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r}\n#| label: setup\n#| message: false\n#| warning: false\n#| include: false\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(colorblindr)\nlibrary(downlit)\n# fonts ----\nlibrary(extrafont)\nlibrary(sysfonts)\nsource(\"_common.R\")\n# use font\nshowtext::showtext_auto()\n# set theme\nggplot2::theme_set(theme_ggp2g(\n    base_size = 11))\n```\n\n```{r}\n#| label: status\n#| results: \"asis\"\n#| echo: false\n# status ----\n# polish, dev, draft, complete\nstatus(\"polish\")\n```\n\n\n:::: {.callout-note collapse=\"false\" icon=false}\n\n<br>\n\n```{r}\n#| label: full_code_display\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '60%'\n#| out-width: '60%'\n#| fig-align: right\nlibrary(palmerpenguins) \nlibrary(ggplot2movies)\nlibrary(ggplot2)\nlibrary(babynames)\ntop_bby_nms_1907 <- babynames::babynames |> \n  dplyr::filter(year == 1907) |> \n  dplyr::arrange(desc(n)) |> \n  dplyr::slice_head(n = 6)\npopular_bby_nms <- babynames::babynames |> \n  dplyr::filter(name %in% top_bby_nms_1907[['name']] & \n      year >= 1917)\n# popular_bby_nms\nlabs_inst_pop_nms <- labs(\n  title = \"Popular names: then and now\", \n  subtitle = \"Most popular names from 1907 appearing between 1917 - 2017\",\n  x = \"Year\", y = \"Name\")\nggp2_inst_pop_nms <- ggplot(data = popular_bby_nms, \n    mapping = aes(x = year, \n                  y = name, \n                  color = name)) + \n  geom_point(aes(alpha = n), \n    shape = 124, size = 5, \n    show.legend = FALSE)\nggp2_inst_pop_nms + \n  labs_inst_pop_nms\n```\n\n::: {style=\"font-size: 1.10em; color: #02577A;\"}\n**This graph requires:**\n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a categorical variable**      \n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a numeric (count) variable**\n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a numeric (date) variable**\n:::\n\n::::\n\n## Description \n\nAn instance chart (or instance graph) displays frequencies (or 'instances') of different categorical values over time time. \n\nThe time dimension is placed on the `x` and each\nseparate categorical item is placed on the `y`-axis. The instances are typically represented using the vertical hashes from `geom_point()` (i.e., shape `124` or the 'pipe' `\"|\"`). \n\nSaturation and color are also used to represent different categorical levels and counts. \n\n## Set up \n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**PACKAGES:**\n:::\n\nInstall packages.\n\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: pkg_code_inst\n#| code-fold: show\n#| eval: false\n#| echo: true\n#| warning: false\n#| message: false\n#| results: hide\ninstall.packages(\"babynames\")\nlibrary(babynames)\nlibrary(ggplot2)\n```\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**DATA:**\n:::\n\n::: {.column-margin}\n![](www/ssa.png){fig-align=\"center\" width=\"60%\" height=\"60%\"}\n:::\n\n<!-- \n::: {.column-margin}\n![Artwork by Allison Horst](www/lter_penguins.png){fig-align=\"right\" width=\"30%\" height=\"30%\"}\n![](www/538.png){fig-align=\"right\" width=\"15%\" height=\"15%\"}\n![](www/imdb.png){fig-align=\"right\" width=\"20%\" height=\"20%\"}\n:::\n-->\n\n\n  - Filter the `babynames::babynames` to only those names in `1887`, then group by `name` and `sex`, arrange descending by the `n`, and store only the top 6 names in `top_bby_nms_1887`. \n\n  - Use the names from `top_bby_nms_1887` to filter `babynames::babynames` for names *after* `1897` and store in `popular_bby_nms`. \n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: data_code_inst\n#| code-fold: show\n#| eval: true\n#| echo: true\nlibrary(babynames)\ntop_bby_nms_1887 <- babynames::babynames |> \n  dplyr::filter(year == 1887) |> \n  dplyr::group_by(name, sex) |> \n  dplyr::slice_max(order_by = sex) |> \n  dplyr::arrange(desc(n)) |> \n  utils::head(n = 6) |> \n  dplyr::ungroup()\ntop_bby_nms_1887\npopular_bby_nms <- babynames::babynames |> \n  dplyr::filter(name %in% top_bby_nms_1887[['name']] & \n      year >= 1897)\n```\n:::\n\n## Grammar\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**CODE:**\n:::\n\n  - Create labels with `labs()`\n\n  - Initialize the graph with `ggplot()` and provide `data`\n\n  - Map `year` to `x`, `name` to `y`, and `color` to `name`\n\n  - Add `geom_point()`, map `n` to `alpha`, and set the `shape` to `124` and `size` to `5`\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: code_graph_inst\n#| code-fold: show\n#| eval: false\n#| echo: true \n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\nlabs_inst_pop_nms <- labs(\n  title = \"Popular names: then and now\",\n  subtitle = \"Most popular names from 1887 appearing between 1897 - 2017\",\n  x = \"Year\",\n  y = \"Name\")\nggp2_inst_pop_nms <- ggplot(data = popular_bby_nms, \n    mapping = aes(x = year, \n                  y = name, \n                  color = name)) + \n  geom_point(aes(alpha = n),\n              shape = 124,\n              size = 5)\nggp2_inst_pop_nms + \n  labs_inst_pop_nms\n```\n:::\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**GRAPH:**\n:::\n\n```{r}\n#| label: create_graph_inst\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nlabs_inst_pop_nms <- labs(\n  title = \"Popular names: then and now\",\n  subtitle = \"Most popular names from 1887 appearing between 1897 - 2017\",\n  x = \"Year\",\n  y = \"Name\")\nggp2_inst_pop_nms <- ggplot(data = popular_bby_nms, \n    mapping = aes(x = year, \n                  y = name, \n                  color = name)) + \n  geom_point(aes(alpha = n),\n              shape = 124,\n              size = 5)\nggp2_inst_pop_nms + \n  labs_inst_pop_nms\n```\n\n\n## More info\n\n### Saturation with `cut_interval()`\n\n`ggplot2` has two great functions for splitting numerical variables into intervals or widths. We're going to create two datasets from `babynames::babynames` that capture the top names in `1900` and and the top names `2000`.\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: top_nms_prop_inst\n#| code-fold: true\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| column: page-inset-right\n#| layout-nrow: 1\ntop_nms_prop_1900 <- babynames::babynames |>\n  dplyr::filter(year == 1900) |>\n  dplyr::group_by(sex, name) |> \n  dplyr::summarise(max_prop = max(prop)) |> \n  dplyr::slice_max(n = 2, order_by = max_prop) |>\n  dplyr::ungroup()\ntop_nms_prop_1900\ntop_nms_prop_2000 <- babynames::babynames |>\n  dplyr::filter(year == 2000) |>\n  dplyr::group_by(sex, name) |> \n  dplyr::summarise(max_prop = max(prop)) |> \n  dplyr::slice_max(n = 2, order_by = max_prop) |>\n  dplyr::ungroup()\ntop_nms_prop_2000\n```\n:::\n\nThese two tibbles tell us something about the top names over a century. The top names in 1900 have much higher proportions than the top names in 2000s.\n\n  - We'll get the names from both tibbles and filter `babynames::babynames` to only these eight names between the years 1900 and 2000. \n\n  - We'll create a `prop_range` variable, which splits the `prop` variable into intervals based on the `length` argument.\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: popular_bby_nms_prop\n#| code-fold: true\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| column: page-inset-right\n#| layout-nrow: 1\nnms_1900 <- top_nms_prop_1900[[\"name\"]]\nnms_2000 <- top_nms_prop_2000[[\"name\"]]\n\ntop_nms_1900_2000 <- c(nms_1900, nms_2000)\n\npopular_bby_nms_prop <- babynames::babynames |>\n  dplyr::filter(name %in% top_nms_1900_2000 &\n                  year >= 1900 &\n                    year <= 2000) |>\n  dplyr::mutate(\n    # proportion range \n    prop_range = ggplot2::cut_interval(x = prop, \n                                       length = 0.025))\n```\n:::\n\n\nBelow we can see the proportion ranges have been built with the [interval notation](https://ggplot2.tidyverse.org/reference/cut_interval.html): `\"(a,b]\"` \n\n  - We can also see the proportion of names changes considerably between the two groups of names. \n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: more_info_color_inst\n#| code-fold: true\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nlabs_inst_pop_nms_prop <- labs(\n  title = \"100 years of popular names\",\n  subtitle = \"Most popular names from 1900 and 2000\",\n  caption = \"*based on proportion\",\n  x = \"Year\",\n  y = \"Name\",\n  color = \"Proportion ranges\",\n  alpha = \"Proportion\")\nggp2_inst_pop_nms_prop <- ggplot(data = popular_bby_nms_prop, \n    mapping = aes(x = year, \n                  y = name, \n              color = prop_range)) + \n  geom_point(aes(alpha = prop),\n                shape = 124,\n                size = 2.5) \nggp2_inst_pop_nms_prop + \n  labs_inst_pop_nms_prop \n```\n\n:::\n\n### Facets with `cut_number()`\n\nTo demonstrate facets, we'll create two other variables: `year_range` and `group`:   \n\n  - `year_range` uses `ggplot2::cut_number()` to create three groups based on the `year`, orders the results, and removes the labels. We manually assign the labels to this variable with `case_when()` and `factor()`    \n  \n  - `group` is a factor variable with two levels: `1900 names` and `2000 names`   \n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: bby_nms_fct_inst\n#| code-fold: true\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\npopular_bby_nms_fct <- popular_bby_nms_prop |>\n  dplyr::mutate(\n    # year range \n    year_range = ggplot2::cut_number(year, \n                                       n = 3, \n                                  labels = FALSE,\n                          ordered_result = TRUE),\n  year_range = case_when(\n    year_range == 1 ~ \"1900 - 1936\",\n    year_range == 2 ~ \"1937 - 1970\",\n    year_range == 3 ~ \"1971 - 2000\"),\n  year_range = factor(year_range,\n    levels = c(\"1900 - 1936\",\n               \"1937 - 1970\",\n               \"1971 - 2000\"),\n    ordered = TRUE),\n    group = case_when(\n      name %in% nms_1900 ~ \"1900 names\",\n      name %in% nms_2000 ~ \"2000 names\",\n      TRUE ~ NA_character_),\n    group = factor(group, \n      levels = c(\"1900 names\", \n                 \"2000 names\")))\n```\n:::\n\nBelow we can see the total counts of names in the cross-table of `year_range` and `group`\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: xtable_popular_bby_nms_fct\n#| code-fold: true\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\npopular_bby_nms_fct |> \n  dplyr::count(year_range, group) |> \n  tidyr::pivot_wider(names_from = group, \n    values_from = n)\n```\n:::\n\nIn the graph, we'll create labels using the `levels` from the `year_range` variable. \n\n  - We can also change the `shape` used in `geom_point()` to the pipe operator (`\"|\"`)\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: bby_nms_facet_inst\n#| code-fold: true\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\n\n# create labels from factor levels \nst_lbls <- paste0(\n              levels(popular_bby_nms_fct$year_range),\n            collapse = \", \")\n\nlabs_inst_pop_nms_facet <- labs(\n  title = \"Baby name popularity over time\",\n  subtitle = paste0(\"Time span: \", st_lbls),\n  x = \"Year\",\n  y = \"Name\")\n\nggp2_inst_pop_nms_facet <- ggplot(popular_bby_nms_fct,\n  mapping = aes(x = year,\n                y = name)) +\n  geom_point(aes(alpha = prop, color = name),\n                 shape = \"|\",\n                 size = 3,\n                 show.legend = FALSE) +\n  facet_wrap(year_range ~ group,\n             scales = \"free_y\", \n             ncol = 2)\nggp2_inst_pop_nms_facet +\n  labs_inst_pop_nms_facet\n```\n:::\n\n::: {style=\"font-size: 0.95rem;\"}\n```{r }\n#| label: bby_nms_facet_inst_notes\n#| code-fold: true\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\n```\n:::\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"fig-asp":0.618,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"show","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"arrow","toc":true,"toc-depth":5,"number-sections":true,"dpi":320,"output-file":"instance_chart.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.28","bibliography":["references.bib"],"theme":["cosmo","custom.scss"],"toc-location":"right","toc-expand":3,"toc-title":"Contents","code-block-bg":"#f8f8f8","code-block-border-left":"#99bbc9","code-annotations":"hover","callout-appearance":"simple","code-summary":"show/hide","fontsize":"1.055em","linestretch":1.25},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}