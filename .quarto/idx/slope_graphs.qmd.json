{"title":"Slope graphs","markdown":{"headingText":"Slope graphs","headingAttr":{"id":"sec-slope-graphs","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r}\n#| label: setup\n#| message: false\n#| warning: false\n#| include: false\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(colorblindr)\nlibrary(downlit)\n# fonts ----\nlibrary(extrafont)\nlibrary(sysfonts)\nsource(\"_common.R\")\n# use font\nshowtext::showtext_auto()\n# set theme\nggplot2::theme_set(theme_ggp2g(\n    base_size = 13))\n```\n\n```{r}\n#| label: status\n#| results: \"asis\"\n#| echo: false\n# status ----\n# polish, dev, draft, complete\nstatus(\"complete\")\n```\n\n:::: {.callout-note collapse=\"false\" icon=false}\n\n<br>\n\n```{r}\n#| label: full_code_display\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '60%'\n#| out-width: '60%'\n#| fig-align: right\nlibrary(palmerpenguins) \nlibrary(ggplot2)\npeng_slope <- palmerpenguins::penguins |>\n    dplyr::filter(year < 2009) |>\n    dplyr::group_by(year, island) |>\n    dplyr::summarise(across(\n        .cols = contains(\"mm\"), \n        .fns = mean, \n            na.rm = TRUE, \n        .names = \"avg_{.col}\")) |>\n    dplyr::ungroup()\nlabs_slope <- labs(\n        title = \"Changes in Bill Depth of Palmer Penguins\", \n        subtitle = \"Years 2007 & 2008\",\n        x = \"Year\", y = \"Bill Depth (mm)\", \n        color = \"Island\")\n\nggp2_slope <- ggplot(data = peng_slope, \n    mapping = aes(x = year,\n                  y = avg_bill_depth_mm, \n              group = island)) +\n  geom_line(aes(color = island), alpha = 1, size = 2, \n      show.legend = FALSE) +\n  geom_point(aes(color = island), alpha = 1, size = 4) + \n  scale_x_continuous(breaks = c(2007, 2008), position = \"top\")\n\nggp2_slope + \n    labs_slope\n```\n\n\n::: {style=\"font-size: 1.10em; color: #02577A;\"}\n**This graph requires:**\n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a categorical variable**      \n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a numeric (continuous) variable**\n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a numeric (date) variable**\n:::\n\n::::\n\n## Description\n\nSlope graphs show changes in a numeric value (displayed on the `y` axis) typically over two points in time (along the `x` axis). The values for each group or unit of measurement are connected by lines, and any differences between the two time points are represented by the slope of the lines (hence the name, 'slope chart').\n\nWe can build slope graphs in `ggplot2` using the `geom_line()` and `geom_point()` functions.\n\n## Set up\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**PACKAGES:**\n:::\n\n::: {style=\"font-size: 0.95rem;\"}\nInstall packages.\n:::\n\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: pkg_code_slope\n#| code-fold: show\n#| eval: false\n#| echo: true\n#| warning: false\n#| message: false\n#| results: hide\ninstall.packages(\"palmerpenguins\")\nlibrary(palmerpenguins)\nlibrary(ggplot2)\n```\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**DATA:**\n:::\n\n::: {.column-margin}\n![Artwork by allison horst](www/lter_penguins.png){fig-align=\"right\" width=\"100%\" height=\"100%\"}\n:::\n\n\nWe'll be using the penguins data for this graph, but slightly restructured. \n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: data_code_slope\n#| code-fold: show\n#| eval: true\n#| echo: true\npeng_slope <- palmerpenguins::penguins |>\n    dplyr::filter(year < 2009) |>\n    dplyr::group_by(year, island) |>\n    dplyr::summarise(across(\n        .cols = contains(\"mm\"), \n        .fns = mean, \n            na.rm = TRUE, \n        .names = \"avg_{.col}\")) |>\n    dplyr::ungroup()\nglimpse(peng_slope)\n```\n:::\n\n\n## Grammar \n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**CODE:**\n:::\n\n  - Create labels with `labs()`\n\n  - Initialize the graph with `ggplot()` and provide `data`\n\n  - Map `year` to the `x`, `avg_bill_depth_mm` to `y`, and `island` to `group`\n\n  - Add a `geom_line()` layer, mapping `island` to `color`, and setting the `size` to `2`\n\n  - Add a `geom_point()` layer, mapping `color` to `island`, and setting `size` to `4`\n\n  - We'll adjust the `x` axis with `scale_x_continuous()`, manually setting the `breaks` and moving the `position` to the `\"top\"` of the graph\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: code_graph_slope\n#| code-fold: show\n#| eval: false\n#| echo: true \n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\nlabs_slope <- labs(\n        title = \"Changes in Bill Depth of Palmer Penguins\", \n        subtitle = \"Years 2007 & 2008\",\n        x = \"Year\", y = \"Bill Depth (mm)\", \n        color = \"Island\")\n\nggp2_slope <- ggplot(data = peng_slope, \n    mapping = aes(x = year,\n                y = avg_bill_depth_mm, \n                group = island)) +\n  geom_line(aes(color = island), \n                size = 2, show.legend = FALSE) +\n  geom_point(aes(color = island), \n                size = 4) + \n  scale_x_continuous(\n                breaks = c(2007, 2008), \n                position = \"top\")\n\nggp2_slope + \n    labs_slope\n```\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**GRAPH:**\n:::\n\n```{r}\n#| label: create_graph_slope\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\nlabs_slope <- labs(\n        title = \"Changes in Bill Depth of Palmer Penguins\", \n        subtitle = \"Years 2007 & 2008\",\n        x = \"Year\", y = \"Average Bill Depth (mm)\", \n        color = \"Island\")\n\nggp2_slope <- ggplot(data = peng_slope, \n    mapping = aes(x = year,\n                y = avg_bill_depth_mm, \n                group = island)) +\n  geom_line(aes(color = island), \n                size = 2, show.legend = FALSE) +\n  geom_point(aes(color = island), \n                size = 4) + \n  scale_x_continuous(\n                breaks = c(2007, 2008), \n                position = \"top\")\n\nggp2_slope + \n    labs_slope\n```\n\n## More info\n\nWe can also use faceting with slope graphs to add a third categorical variable.\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**DATA:**\n:::\n\nWe'll be using the `penguins` dataset again, but group remove the missing values and group it by `year`, `island`, and `sex`. \n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: data_code_grp_slope\n#| eval: true\n#| echo: true\npeng_grp_slope <- palmerpenguins::penguins |>\n    dplyr::select(year, sex, island,\n                  contains(\"mm\")) |> \n    tidyr::drop_na() |> \n    dplyr::filter(year != 2007) |>\n    dplyr::group_by(year, sex, island) |>\n    dplyr::summarise(across(\n        .cols = contains(\"mm\"), \n        .fns = mean, \n            na.rm = TRUE, \n        .names = \"avg_{.col}\")) |>\n    dplyr::ungroup()\nglimpse(peng_grp_slope)\n```\n\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**GRAPH:**\n:::\n\n  - Create labels with `labs()` \n\n  - Initialize the graph with `ggplot()` and provide `data`\n\n  - Map `year` to the `x`, `avg_bill_depth_mm` to `y`, and `island` to `group`\n\n  - Add a `geom_line()` layer, mapping `island` to `color`, and setting the `size` to `2`\n\n  - Add a `geom_point()` layer, mapping `color` to `island`, and setting `size` to `4`\n\n  - We'll adjust the `x` axis with `scale_x_continuous()`, manually setting the `breaks` and moving the `position` to the `\"top\"` of the graph\n\n  - We'll duplicate the the `y` axis with `sec.axis`, setting `dup_axis()` to the same `name` of the previous `y` label.\n\n  - Finally, we facet the graph by `sex`, adjust the `size` of the text, and move the legend to the `\"bottom\"` of the graph.\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: create_graph_grp_slope\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\nlabs_grp_slope <- labs(\n    title = \"Changes in Bill Depth of Palmer Penguins\",\n    subtitle = \"Years 2008 & 2009\",\n    x = \"\",\n    color = \"Island\")\n\nggp2_grp_slope <- ggplot(data = peng_grp_slope,\n    mapping = aes(x = year,\n        y = avg_bill_depth_mm,\n        group = island)) +\n    geom_line(aes(color = island),\n        size = 2, show.legend = FALSE) +\n    geom_point(aes(color = island),\n        size = 4) +\n    scale_x_continuous(breaks = c(2008, 2009),\n        position = \"top\") +\n    scale_y_continuous(name = \"Average Bill Depth (mm)\",\n        sec.axis = dup_axis(name = \"Average Bill Depth (mm)\")) +\n    facet_wrap(. ~ sex,\n        ncol = 2) +\n    theme_minimal(base_size = 14) +\n    theme(\n        legend.position = \"bottom\",\n        axis.text.x = element_text(size = 9),\n        axis.text.y = element_text(size = 9),\n        strip.text = element_text(size = 10))\n\nggp2_grp_slope +\n    labs_grp_slope\n```\n:::\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"show","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"arrow","toc":true,"toc-depth":5,"number-sections":true,"dpi":320,"output-file":"slope_graphs.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","bibliography":["references.bib"],"theme":["cosmo","custom.scss"],"toc-location":"right","toc-expand":3,"toc-title":"Contents","code-block-bg":"#f8f8f8","code-block-border-left":"#99bbc9","code-annotations":"hover","callout-appearance":"simple","code-summary":"show/hide","fig-asp":0.618,"fontsize":"1.055em","linestretch":1.25},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}