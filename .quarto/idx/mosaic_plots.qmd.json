{"title":"Mosaic plots","markdown":{"headingText":"Mosaic plots","headingAttr":{"id":"","classes":["unnumbered"],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r}\n#| label: setup\n#| message: false\n#| warning: false\n#| include: false\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(colorblindr)\nlibrary(downlit)\nlibrary(patchwork)\n# fonts ----\nlibrary(extrafont)\nlibrary(sysfonts)\nlibrary(fivethirtyeight) \nlibrary(ggmosaic)\nsource(\"_common.R\")\n# use font\nshowtext::showtext_auto()\n# set theme\nggplot2::theme_set(theme_ggp2g(\n    base_size = 14))\n```\n\n```{r}\n#| label: status\n#| results: \"asis\"\n#| echo: false\n# status ----\n# polish, dev, draft, complete\nstatus(\"complete\")\n```\n\n:::: {.callout-note collapse=\"false\" icon=false}\n\n::: {style=\"font-size: 1.25em; font-weight: bold; color: #02577A;\"}\nGraph info\n:::\n\n<br>\n\n```{r}\n#| label: full_code_display\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '60%'\n#| out-width: '60%'\n#| fig-align: right\nlibrary(fivethirtyeight) \nlibrary(ggmosaic)\nlibrary(ggplot2) \nfly_mosaic <- fivethirtyeight::flying |> \n                dplyr::select(baby, unruly_child, recline_rude) |> \n                tidyr::drop_na()\nlabs_mosaic <- labs(\n      title = \"In general...\", \n      subtitle = \"...is it rude to...\",\n      x = \"... bring a baby on a plane?\",\n      y = \"...knowingly bring unruly children on a plane?\",\n      fill = \"Response\") \nggp2_mosaic <- ggplot(data = fly_mosaic) +\n   ggmosaic::geom_mosaic(mapping = \n          aes(x = product(unruly_child, baby), \n              fill = baby)) + \n    ggmosaic::theme_mosaic(base_size = 10) + \n    theme(legend.position = \"bottom\")\nggp2_mosaic + \n    labs_mosaic\n```\n\n::: {style=\"font-size: 1.10em; color: #02577A;\"}\n**This graph requires:**\n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n`r emo::ji(\"check\")` at least two categorical variables      \n:::\n\n::::\n\n## Description \n\nA mosaic plot is similar to a stacked bar graph, but instead of only relying on height and color to display the relative amount for each value, mosaic plots also use width.\n\nMosaic plot legends should be positioned on top or bottom and justified horizontally to preserve shape and improve readability. \n\nWe can build mosaic plots using the [`ggmosaic` package.](https://haleyjeppson.github.io/ggmosaic/)\n\n## Set up\n\n:::: {.panel-tabset}\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**PACKAGES:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nInstall packages.\n:::\n\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: pkg_code_mosaic\n#| code-fold: show\n#| eval: false\n#| echo: true\n#| warning: false\n#| message: false\n#| results: hide\ninstall.packages(\"fivethirtyeight\")\nlibrary(fivethirtyeight) \n# pak::pak(\"haleyjeppson/ggmosaic\")\nlibrary(ggmosaic)\nlibrary(ggplot2)\n```\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**DATA:**\n:::\n\n::: {.column-margin}\n![](www/538.png){fig-align=\"right\" width=\"45%\" height=\"45%\"}\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nFor this graph, we'll be using the `fivethirtyeight::flying` dataset, after removing the missing values from `baby`, `recline_rude`,  and `unruly_child`. \n:::\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: data_code_mosaic\n#| code-fold: show\n#| eval: true\n#| echo: true\nfly_mosaic <- fivethirtyeight::flying |> \n                dplyr::select(baby, unruly_child, recline_rude) |> \n                tidyr::drop_na()\nglimpse(fly_mosaic)\n```\n:::\n::::\n\n## Grammar\n\n:::: {.panel-tabset}\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**CODE:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\n\nCreate labels with `labs()`\n\nInitialize the graph with `ggplot()` and provide `data`\n\nMap the `product()` of `unruly_child` and `baby` to the `x` axis\n\nMap `baby` to `fill`\n\nAdd `theme_mosaic()`\n\nMove the legend to the bottom with `theme(legend.position = \"bottom\")`\n\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: code_graph_mosaic\n#| code-fold: show\n#| eval: false\n#| echo: true \n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\nlabs_mosaic <- labs(\n      title = \"In general...\", \n      subtitle = \"...is it rude to...\",\n      x = \"... bring a baby on a plane?\",\n      y = \"...knowingly bring unruly children on a plane?\",\n      fill = \"Response\") \nggp2_mosaic <- ggplot(data = fly_mosaic) +\n   ggmosaic::geom_mosaic(mapping = \n          aes(x = product(unruly_child, baby), \n              fill = baby)) + \n    ggmosaic::theme_mosaic(base_size = 10) + \n    theme(legend.position = \"bottom\")\nggp2_mosaic + \n    labs_mosaic\n```\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**GRAPH:**\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: run_graph_mosaic\n#| eval: true\n#| echo: false \n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nlabs_mosaic <- labs(\n      title = \"In general...\", \n      subtitle = \"...is it rude to...\",\n      x = \"... bring a baby on a plane?\",\n      y = \"...knowingly bring unruly children on a plane?\",\n      fill = \"Response\") \nggp2_mosaic <- ggplot(data = fly_mosaic) +\n   ggmosaic::geom_mosaic(mapping = \n          aes(x = product(unruly_child, baby), \n              fill = baby)) + \n    ggmosaic::theme_mosaic(base_size = 10) + \n    theme(legend.position = \"bottom\")\nggp2_mosaic + \n    labs_mosaic\n```\n:::\n\n### Details\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**DETAILS:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nWe've re-written the labels for the mosaic plot (`ggp2_mosaic`) to illustrate what's happening in the `aes()` of `geom_mosaic()`.\n:::\n\n::: {.column-margin}\n::: {style=\"font-size: 0.95em; color: #5f2042;\"}\nIt's a good idea to adjust the `fig-height` and `fig-width` of your graph\n:::\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: create_table_mosaic\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| fig-align: center\n#| column: page-inset-right\n# graph\nlabs_mosaic <- labs(\n      title = \"In general...is it rude to...\", \n      subtitle = \"f(unruly_child | baby) f(baby)\",\n      x = \"... bring a baby on a plane?\",\n      y = \"...knowingly bring unruly children on a plane?\",\n      fill = \"Response\") \nggp2_mosaic <- ggplot(data = fly_mosaic) +\n   ggmosaic::geom_mosaic(mapping = \n          aes(x = product(unruly_child, baby), \n              fill = baby)) + \n    ggmosaic::theme_mosaic(base_size = 10) + \n    theme(legend.position = \"bottom\")\nggp2_mosaic + \n    labs_mosaic\n# table\nfly_mosaic_counts <- fly_mosaic |>\n    dplyr::count(unruly_child, baby) |> \n    tidyr::pivot_wider(names_from = baby, values_from = n) |> \n    dplyr::arrange(desc(unruly_child)) |> \n    dplyr::mutate(\n        Very = as.character(Very),\n        Very = tidyr::replace_na(Very, \"\"))\n\nkableExtra::kable_paper(\n  kable_input = knitr::kable(fly_mosaic_counts), \n  font_size = 14)\n```\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nThe table above displays the counts for each combined response. As we can see, the counts are represented by height and width in the graph.\n:::\n\n::::\n\n## More info\n\nI recommend reading the [`ggmosaic` vignette](https://haleyjeppson.github.io/ggmosaic/articles/ggmosaic.html), particularly the sections on ordering and conditioning. \n\n:::: {.panel-tabset}\n\n### Two variables\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: fly_mosaic_2var_counts\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| column: margin\n# table\nfly_mosaic_2var_counts <- fly_mosaic |> \n    dplyr::count(unruly_child, recline_rude) |> \n    tidyr::pivot_wider(names_from = recline_rude, values_from = n) |> \n    dplyr::arrange(desc(unruly_child))\n\nkableExtra::kable_paper(\n  kable_input = knitr::kable(fly_mosaic_2var_counts), \n  font_size = 12)\n```\n:::\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**TWO VARIABLES:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nBelow is another example of a two-variable mosaic plot, mapping the `product()` variables as `unruly_child` and `recline_rude`, and the `fill` variable as `recline_rude`.\n\nOnce again we can see the counts for each category in the cross-tabulation:\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: ggp2_mosaic_2var\n#| eval: true\n#| echo: true\n#| error: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\n# build 2-variable mosiac plot\nlabs_mosaic_2var <- labs(\n  title = \"In general...is it rude to...\", \n  subtitle = \"2-Variable plot\",\n  x = \"... recline your seat on a plane?\",\n  y = \"...knowingly bring unruly children on a plane?\",\n  fill = \"recline_rude responses\")\n\nggp2_mosaic_2var <- ggplot(data = fly_mosaic) +\n  geom_mosaic(aes(\n    x = product(unruly_child, recline_rude),\n    fill = recline_rude)) +\n  ggmosaic::theme_mosaic(base_size = 10) + \n  theme(legend.position = \"bottom\")\n  \nggp2_mosaic_2var + \n    labs_mosaic_2var\n```\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nFor conditional variables, we map the `product()` variable as `unruly_child` and the `fill` variable as `baby`, but include a `conds` variable (as `product(recline_rude)`).\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: ggp2_mosaic_cond\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\n# build conditional mosiac plot\nlabs_mosaic_cond <- labs(\n  title = \"In general...is it rude to...\", \n  subtitle = \"Conditional plot\",\n  x = \"...recline your seat on a plane?\",\n  y = \"...knowingly bring unruly children on a plane?\",\n  fill = \"unruly_child responses\")\nggp2_mosaic_cond <- ggplot(data = fly_mosaic) +\n  geom_mosaic(aes(\n    x = product(unruly_child), # product variable\n    fill = unruly_child,\n    conds = product(recline_rude))) + # conditional variable\n  ggmosaic::theme_mosaic(base_size = 10) + \n  theme(legend.position = \"bottom\")\n\nggp2_mosaic_cond + \n    labs_mosaic_cond\n```\n:::\n\n### Facets\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**FACETS:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\n\nAnother option for including a conditioning variable is including facets. In the example below we use `recline_rude` in both `x` and `fill` (remember to wrap `recline_rude` in `product()`).\n\nThe `divider` argument let's us control the spine partitions (vertically and horizontally). Below are the two vertical orientation options for the `divider` argument. \n:::\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: patchwork_mosaic_run_v\n#| eval: true\n#| echo: false\n#| error: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nlabs_mosaic_facet <- labs(\n        title = \"In general...is it rude to...\",\n        caption = \"divider = 'vspine'\",\n        y = \"...recline your seat on a plane?\",\n        x = \"...knowingly bring unruly children on a plane?\",\n        fill = \"recline_rude responses\") \nggp2_mosaic_vspine <- ggplot(data = fly_mosaic) +\n          ggmosaic::geom_mosaic(aes(x = product(recline_rude), \n                                 fill = recline_rude), \n                              divider = \"vspine\") +\n                    facet_grid(. ~ unruly_child) + \n            ggmosaic::theme_mosaic(base_size = 8) + \n            theme(\n                axis.text.x = element_blank(),\n                axis.ticks.x = element_blank(),\n                panel.grid.minor.x = element_blank(),\n                panel.grid.major = element_blank()) +\n            labs_mosaic_facet +\n            labs(caption = \"divider = 'vspine'\") \n\nggp2_mosaic_vbar <- ggplot(data = fly_mosaic) +\n          ggmosaic::geom_mosaic(aes(x = product(recline_rude), \n                                 fill = recline_rude), \n                              divider = \"vbar\") +\n                    facet_grid(. ~ unruly_child) +\n            ggmosaic::theme_mosaic(base_size = 8) + \n            theme(\n                axis.text.x = element_blank(),\n                axis.ticks.x = element_blank(),\n                panel.grid.minor.x = element_blank(),\n                panel.grid.major = element_blank()) +\n            labs_mosaic_facet +\n            labs(caption = \"divider = 'vbar'\") \n\nggp2_mosaic_vspine + \n    ggp2_mosaic_vbar + \n  patchwork::plot_layout(\n    nrow = 2, guides = 'collect')\n```\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nThe two horizontal orientation options make the axis text harder to read, so these need to be manipulated manually. \n:::\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: patchwork_mosaic_run_h\n#| eval: true\n#| echo: false\n#| error: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nggp2_mosaic_hspine <- ggplot(data = fly_mosaic) +\n          ggmosaic::geom_mosaic(aes(x = product(recline_rude), \n                                 fill = recline_rude), \n                              divider = \"hspine\") +\n                    facet_grid(. ~ unruly_child) + \n            ggmosaic::theme_mosaic(base_size = 8) + \n            theme(\n                axis.text.x = element_blank(),\n                axis.ticks.x = element_blank(),\n                panel.grid.minor.x = element_blank(),\n                panel.grid.major = element_blank()) +\n            labs_mosaic_facet +\n            labs(caption = \"divider = 'hspine'\") \n\n\nggp2_mosaic_hbar <- ggplot(data = fly_mosaic) +\n          ggmosaic::geom_mosaic(aes(x = product(recline_rude), \n                                 fill = recline_rude), \n                              divider = \"hbar\") +\n                    facet_grid(. ~ unruly_child) + \n            ggmosaic::theme_mosaic(base_size = 8) + \n            theme(\n                axis.text.x = element_blank(),\n                axis.ticks.x = element_blank(),\n                panel.grid.minor.x = element_blank(),\n                panel.grid.major = element_blank()) +\n            labs_mosaic_facet +\n            labs(caption = \"divider = 'hbar'\") \n\nggp2_mosaic_hspine + \n    ggp2_mosaic_hbar + \n  patchwork::plot_layout(\n    nrow = 2, guides = 'collect')\n```\n:::\n\n::::\n\n\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"show","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"arrow","toc":true,"toc-depth":5,"number-sections":true,"dpi":320,"output-file":"mosaic_plots.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","bibliography":["references.bib"],"theme":["cosmo","custom.scss"],"toc-location":"right","toc-title":"Contents","code-block-bg":"#f8f8f8","code-block-border-left":"#99bbc9","code-annotations":"hover","callout-appearance":"simple","code-summary":"show/hide","fig-asp":0.618,"fontsize":"1.085em","linestretch":1.25},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}