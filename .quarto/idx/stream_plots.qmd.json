{"title":"Stream plots","markdown":{"headingText":"Stream plots","headingAttr":{"id":"sec-stream-plots","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r}\n#| label: setup\n#| message: false\n#| warning: false\n#| include: false\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(colorblindr)\nlibrary(downlit)\n# fonts ----\nlibrary(extrafont)\nlibrary(sysfonts)\nsource(\"_common.R\")\n# use font\nshowtext::showtext_auto()\n# set theme\nggplot2::theme_set(theme_ggp2g(\n    base_size = 15))\nremotes::install_github(\"davidsjoberg/ggstream\")\n```\n\n```{r}\n#| label: status\n#| results: \"asis\"\n#| echo: false\n# status ----\n# polish, dev, draft, complete\nstatus(\"complete\")\n```\n\n:::: {.callout-note collapse=\"false\" icon=false}\n\n<br>\n\n```{r}\n#| label: full_code_display\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '75%'\n#| out-width: '75%'\n#| fig-align: right\nlibrary(ggplot2movies)\nlibrary(ggstream)\nlibrary(ggplot2)\nmovies_stream <- ggplot2movies::movies |> \n    dplyr::select(mpaa, year, budget) |> \n    tidyr::drop_na() |> \n    dplyr::filter(mpaa != \"\") |> \n    dplyr::mutate(mpaa = factor(mpaa, \n                            levels = c(\"NC-17\", \"R\", \n                                       \"PG-13\", \"PG\"), \n                            ordered = TRUE)) |> \n    dplyr::group_by(year, mpaa) |> \n    dplyr::summarise(\n        avg_budget = mean(budget, na.rm = TRUE)) |> \n    dplyr::ungroup() |> \n    dplyr::filter(year > 1984)\nlabs_stream <- labs(\n    title = \"20 years of movie budgets\", \n    subtitle = \n        paste0(\"movies between\", \n            min(movies_stream$year), \n            \" and \", \n            max(movies_stream$year)),\n    x = \"Year\", \n    y = \"Average Movie Budget\")\nggp2_stream <- ggplot(data = movies_stream, \n    mapping = aes(x = year, \n                  y = avg_budget, \n                  fill = mpaa)) + \n    ggstream::geom_stream() + \n    scale_y_continuous(labels = scales::dollar)\nggp2_stream + \n    labs_stream + \n    theme(legend.position = \"bottom\")\n```\n\n::: {style=\"font-size: 1.10em; color: #02577A;\"}\n**This graph requires:**\n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a categorical variable**   \n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a numeric (continuous) variable** \n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a numeric (date) variable**  \n:::\n\n::::\n\n## Description \n\nStream graphs display how a numerical variable (typically on the `y` axis) changes over time (on the `x` axis) across levels of a categorical variable. These graphs are handy if the numerical value varies wildly (or isn't always present) over the time measurement.  \n\nCategorical groups are differentiated by color layers, with the area of the layer representing the change in `y` value. In `ggplot2`, we can create stream graphs using [ggstream.](https://github.com/davidsjoberg/ggstream)\n\n## Set up\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**PACKAGES:**\n:::\n\nInstall packages.\n\n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: pkg_code_stream\n#| code-fold: show\n#| eval: false\n#| echo: true\n#| warning: false\n#| message: false\n#| results: hide\nremotes::install_github(\"davidsjoberg/ggstream\")\ninstall.packages(\"ggplot2movies\")\nlibrary(ggstream)\nlibrary(ggplot2movies)\nlibrary(ggplot2)\n```\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**DATA:**\n:::\n\n::: {.column-margin}\n![](www/imdb.png){fig-align=\"right\" width=\"40%\" height=\"40%\"}\n:::\n\nWe're going to use only the `mpaa`, `year`, and `budget` columns from `ggplot2movies::movies`, then drop all missing values (we have to remove special missing characters from `mpaa`). \n\nWe'll then convert `mpaa` to an ordered factor, then group by `year` and `mpaa` to calculate the average budget and filter to only those movies after `1984`. \n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: data_code_stream\n#| code-fold: show\n#| eval: true\n#| echo: true\nmovies_stream <- ggplot2movies::movies |> \n    dplyr::select(mpaa, year, budget) |> \n    tidyr::drop_na() |> \n    dplyr::filter(mpaa != \"\") |> \n    dplyr::mutate(mpaa = factor(mpaa, \n                            levels = c(\"NC-17\", \"R\", \n                                       \"PG-13\", \"PG\"), \n                            ordered = TRUE)) |> \n    dplyr::group_by(year, mpaa) |> \n    dplyr::summarise(\n        avg_budget = mean(budget, na.rm = TRUE)) |> \n    dplyr::ungroup() |> \n    dplyr::filter(year > 1984)\ndplyr::glimpse(movies_stream)\n```\n:::\n\n## Grammar\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**CODE:**\n:::\n\n  - Create labels with `labs()`\n\n    - Use `paste0()` in the `subtitle` to automatically update the `year` when the `movies_stream` changes   \n\n  - Initialize the graph with `ggplot()` and provide `data`\n\n  - Map `year` to the `x`, `avg_budget` to `y`, and `mpaa` to `fill`\n\n  - Add the `geom_stream()` layer \n\n  - Adjust the `y` axis with `scale_y_continuous()` and `scales::dollar`\n\n  - Finally, move the legend with  `theme(legend.position = \"bottom\")` \n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: code_graph_stream\n#| code-fold: show\n#| eval: false\n#| echo: true \n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\nlabs_stream <- labs(\n    title = \"20 years of movie budgets\", \n    subtitle = \n        paste0(\"movies between\", \n            min(movies_stream$year), \n            \" and \", \n            max(movies_stream$year)),\n    x = \"Year\", \n    y = \"Average Movie Budget\")\n\nggp2_stream <- ggplot(data = movies_stream, \n    mapping = aes(x = year, \n                  y = avg_budget, \n                  fill = mpaa)) + \n    ggstream::geom_stream() + \n    scale_y_continuous(labels = scales::dollar)\nggp2_stream + \n    labs_stream + \n    theme(legend.position = \"bottom\")\n```\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**GRAPH:**\n:::\n\n```{r}\n#| label: create_graph_stream\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nlabs_stream <- labs(\n    title = \"20 years of movie budgets\", \n    subtitle = \n        paste0(\"movies between\", \n            min(movies_stream$year), \n            \" and \", \n            max(movies_stream$year)),\n    x = \"Year\", \n    y = \"Average Movie Budget\")\nggp2_stream <- ggplot(data = movies_stream, \n    mapping = aes(x = year, \n                  y = avg_budget, \n                  fill = mpaa)) + \n    ggstream::geom_stream() + \n    scale_y_continuous(labels = scales::dollar)\nggp2_stream + \n    labs_stream + \n    theme(legend.position = \"bottom\")\n```\n\n## More info\n\nThe [`ggstream` package](https://github.com/davidsjoberg/ggstream) has multiple arguments for adjusting the shape and look of the categorical levels (and text labels).\n\n### Type\n\n  - Map `mpaa` to `fill` (wrapped in `forcats::fct_rev()`)\n\n  - We can adjust the look of the graph by setting the `type` argument in `geom_stream()`\n\n    - `type`: change type from `\"mirror\"` (the default) to `\"proportional\"`\n\n  - Adjust colors: \n\n    - `scale_fill_manual()`: Add colors as a named vector to `values`\n\n  - Finally, add the `fill` to the labels and move the legend with  `theme(legend.position = \"bottom\")` \n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: code_graph_type\n#| eval: true\n#| echo: true \n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nggp2_stream_prp <- ggplot(data = movies_stream, \n    mapping = aes(x = year, \n                  y = avg_budget, \n                  fill = forcats::fct_rev(mpaa))) + \n    ggstream::geom_stream(type = \"proportional\") + \n    scale_y_continuous(labels = scales::percent) + \n  scale_fill_manual(\n      values = c(\"PG-13\" = \"#0bd3d3\", \n                 \"PG\" = \"#f890e7\", \n                 \"R\" = \"#282b2d\", \n                 \"NC-17\" = \"#772953\"))\nggp2_stream_prp + \n    labs_stream + \n    labs(fill = \"mpaa\") + \n    theme(legend.position = \"bottom\")\n```\n:::\n\n### Sorting\n\nTo change how the categorical areas are sorted, adjust the sorting argument to either `\"none\"`, `\"onset\"`, or `\"inside_out\"`  \n\n  - `sorting`: set the `sorting` method to `\"inside_out\"` in *both* `ggstream::geom_stream()` and `ggstream::geom_stream_label()` \n  \n  - `type`: change the type to `\"ridge\"` in *both* `ggstream::geom_stream()` and `ggstream::geom_stream_label()`    \n\nWe can also add text labels using `ggstream::geom_stream_label()`:\n\n  - Map `mpaa` (wrapped in `forcats::fct_rev()`) to `label` globally  \n  \n  - Inside `ggstream::geom_stream_label()`:  \n  \n    - set color to white (`\"#ffffff\"`) and the `size` to `2.7` \n    \n    - Remove the legend with `show.legend = FALSE`  \n\nColors:\n\n  - Use `scale_colour_manual()` and `scale_fill_manual()` to manually set the values using a named vector \n\n    - Change the `y` axis to US dollars using `scale_y_continuous()` and `scales::dollar`\n\n  - Finally, add the `fill` to the labels and move the legend with  `theme(legend.position = \"bottom\")` \n\n::: {style=\"font-size: 0.85em;\"}\n```{r}\n#| label: create_graph_sorting\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nggp2_stream_srt <- ggplot(data = movies_stream, \n    mapping = aes(x = year, \n                  y = avg_budget, \n                  fill = fct_rev(mpaa),\n                  label = fct_rev(mpaa))) + \n    ggstream::geom_stream(\n        type = \"ridge\", \n        sorting = \"inside_out\") + \n    ggstream::geom_stream_label(\n        type = \"ridge\", \n        sorting = \"inside_out\", \n        color = \"#ffffff\", \n        size = 2.7,\n        show.legend = FALSE) +\n    scale_colour_manual(\n      values = c(\"PG-13\" = \"#0bd3d3\", \n                 \"PG\" = \"#f890e7\", \n                 \"R\" = \"#282b2d\", \n                 \"NC-17\" = \"#772953\")) +\n    scale_fill_manual(\n      values = c(\"PG-13\" = \"#0bd3d3\", \n                 \"PG\" = \"#f890e7\", \n                 \"R\" = \"#282b2d\", \n                 \"NC-17\" = \"#772953\")) + \n    scale_y_continuous(labels = scales::dollar) \n    \nggp2_stream_srt + \n    labs_stream + \n    labs(fill = \"mpaa\") + \n    theme(legend.position = \"bottom\")\n```\n:::\n\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"fig-asp":0.618,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"show","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"arrow","toc":true,"toc-depth":5,"number-sections":true,"dpi":320,"output-file":"stream_plots.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.28","bibliography":["references.bib"],"theme":["cosmo","custom.scss"],"toc-location":"right","toc-expand":3,"toc-title":"Contents","code-block-bg":"#f8f8f8","code-block-border-left":"#99bbc9","code-annotations":"hover","callout-appearance":"simple","code-summary":"show/hide","fontsize":"1.055em","linestretch":1.25},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}