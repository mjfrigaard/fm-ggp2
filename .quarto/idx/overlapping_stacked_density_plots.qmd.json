{"title":"Overlapping density plot","markdown":{"headingText":"Overlapping density plot","headingAttr":{"id":"","classes":["unnumbered"],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r}\n#| label: setup\n#| message: false\n#| warning: false\n#| include: false\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(colorblindr)\nlibrary(downlit)\n# fonts ----\nlibrary(extrafont)\nlibrary(sysfonts)\nsource(\"_common.R\")\n# use font\nshowtext::showtext_auto()\n# set theme\nggplot2::theme_set(theme_ggp2g(\n    base_size = 15))\n```\n\n```{r}\n#| label: status\n#| results: \"asis\"\n#| echo: false\n# status ----\n# polish, dev, draft, complete\nstatus(\"complete\")\n```\n\n\n\n:::: {.callout-note collapse=\"false\" icon=false}\n\n::: {style=\"font-size: 1.25em; color: #02577A;\"}\nGraph info\n:::\n\n<br>\n\n```{r}\n#| label: full_code_display\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '60%'\n#| out-width: '60%'\n#| fig-align: right\nlibrary(palmerpenguins) \nlibrary(ggplot2)\nlibrary(patchwork)\npeng_density <- filter(penguins, !is.na(sex))\nlabs_ovrlp_density <- labs(\n  subtitle = \"position = 'identity'\",\n  x = \"Flipper length (mm)\",\n  fill = \"Sex\")\nggp2_ovrlp_density <- ggplot(data = peng_density, \n       aes(x = flipper_length_mm, \n           fill = sex)) +\n      geom_density(alpha = 1/3) \n\novrlp_density <- ggp2_ovrlp_density + \n  labs_ovrlp_density + \n    ggplot2::theme_minimal(base_size = 11)\n\nlabs_stack_density <- labs(\n  subtitle = \"position = 'stack'\",\n  x = \"Flipper length (mm)\", \n  fill = \"Sex\")\nggp2_stack_density <- ggplot(data = peng_density, \n       aes(x = flipper_length_mm, \n           after_stat(count),\n           fill = sex)) +\n      geom_density(position = \"stack\", \n                   alpha = 1/3) \nstack_density <- ggp2_stack_density + \n  labs_stack_density + \n    ggplot2::theme_minimal(base_size = 11)\novrlp_density + stack_density + \n    patchwork::plot_layout(ncol = 1)\n```\n\n::: {style=\"font-size: 1.10em; color: #02577A;\"}\n**This graph requires:**\n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a categorical variable**      \n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**`r emo::ji(\"check\")` a numeric (continuous) variable**\n:::\n\n::::\n\n## Description \n\nDensity plots are [*smoothed version(s) of  histogram(s)*](https://ggplot2.tidyverse.org/reference/geom_density.html). They can are great for comparing the distributions of a continuous variable across the levels of a categorical variable. \n\n`geom_density()` creates a kernel density estimate. The default `position` argument is `\"identity\"`, which takes the data as is. However, we can change `position` to `\"stack\"` to display overlapping distributions.\n\n## Set up\n\n:::: {.panel-tabset}\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**PACKAGES:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nInstall packages.\n:::\n\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: pkg_code_ovrlp_density\n#| code-fold: show\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| results: hide\ninstall.packages(\"palmerpenguins\")\nlibrary(palmerpenguins)\nlibrary(ggplot2)\n```\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**DATA:**\n:::\n\n::: {.column-margin}\n![Artwork by allison horst](www/lter_penguins.png){fig-align=\"right\" width=\"100%\" height=\"100%\"}\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nRemove missing `sex` from the `penguins` data\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: data_code_ovrlp_density\n#| code-fold: show\n#| eval: true\n#| echo: true\npeng_density <- dplyr::filter(penguins, !is.na(sex))\ndplyr::glimpse(peng_density)\n```\n:::\n::::\n\n## Grammar\n\n:::: {.panel-tabset}\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**CODE:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\n\nCreate labels with `labs()`\n\nInitialize the graph with `ggplot()` and provide `data`\n\nMap the `flipper_length_mm` to the `x` and `sex` to `fill` \n\nAdd the `geom_density()`  \n\nSet the `alpha` to `1/3` (to handle the overlapping areas)\n\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: code_graph_ovrlp_density\n#| code-fold: show\n#| eval: false\n#| echo: true \n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\nlabs_ovrlp_density <- labs(\n  title = \"Adult foraging penguins\",\n  x = \"Flipper length (millimeters)\",\n  fill = \"Sex\")\nggp2_ovrlp_density <- ggplot(data = peng_density, \n       aes(x = flipper_length_mm, \n           fill = sex)) +\n      geom_density(alpha = 1/3) \nggp2_ovrlp_density + \n  labs_ovrlp_density\n```\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**GRAPH:**\n:::\n\n::: {.column-margin}\n*A downside of density plots is the lack of interpretability of the `y` axis*\n:::\n\n\n::: {style=\"font-size: 0.85em;\"}\nMake density area slightly transparent to handle over-plotting\n:::\n\n```{r}\n#| label: create_graph_ovrlp_density\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nlabs_ovrlp_density <- labs(\n  title = \"Adult foraging penguins\",\n  x = \"Flipper length (millimeters)\",\n  fill = \"Sex\")\nggp2_ovrlp_density <- ggplot(data = peng_density, \n       aes(x = flipper_length_mm, \n           fill = sex)) +\n      geom_density(alpha = 1/3) \nggp2_ovrlp_density + \n  labs_ovrlp_density\n```\n\n::::\n\n## More info\n\n`ggplot2` has multiple options for overlapping density plots, so which one to use will depend on how you'd like to display the relative distributions in your data. We'll cover three options below:\n\n:::: {.panel-tabset}\n\n### `\"stack\"`\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**STACK:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nIf we change the `position` to `\"stack\"` we can see the smoothed estimates are 'stacked' on top each other (and the `y` axis shifts slightly).\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n\n```{r}\n#| label: code_graph_stack_density\n#| eval: true\n#| echo: true \n#| warning: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nlabs_stack_density <- labs(\n    title = \"Adult foraging penguins\",\n    x = \"Flipper length (millimeters)\",\n    fill = \"Sex\")\nggp2_stack_density <- ggplot(data = peng_density,\n    mapping = aes(x = flipper_length_mm,\n               fill = sex)) +\n    geom_density(position = \"stack\",\n                 alpha = 1 / 3)\nggp2_stack_density +\n    labs_stack_density\n```\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nSetting `position` to `'stack'` [loses marginal densities](https://ggplot2.tidyverse.org/reference/geom_density.html#ref-examples)\n:::\n\n### `after_stat(count)`\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**AFTER STAT:** \n:::\n\n::: {style=\"font-size: 0.85em;\"}\nIf we include `after_stat(count)` as one of our mapped aesthetics, the mapping is postponed until after statistical transformation, and uses the [*`density * n` instead of the default density*](https://ggplot2.tidyverse.org/reference/geom_density.html#computed-variables).\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: code_graph_after_stat_density\n#| eval: true\n#| echo: true \n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nlabs_after_stat_density <- labs(\n  title = \"Adult foraging penguins\",\n  x = \"Flipper length (millimeters)\", \n  fill = \"Sex\")\nggp2_after_stat_density <- ggplot(data = peng_density, \n       aes(x = flipper_length_mm, \n           after_stat(count),\n           fill = sex)) +\n      geom_density(position = \"stack\", \n                   alpha = 1/3) \nggp2_after_stat_density + \n  labs_after_stat_density\n```\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nAdding [`after_stat(count)`](https://ggplot2.tidyverse.org/reference/geom_density.html#computed-variables) *'preserves marginal densities.'*, which result in more a interpretable `y` axis (depending on the audience)\n:::\n\n### `\"fill\"`\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**FILL:** \n:::\n\n::: {style=\"font-size: 0.85em;\"}\nUsing `after_stat(count)` with `position = \"fill\"` creates in a conditional density estimate. \n:::\n\n\n::: {style=\"font-size: 0.75em;\"}\n```{r}\n#| label: code_graph_fill_density\n#| eval: true\n#| echo: true \n#| warning: false\n#| message: false\n#| out-height: '100%'\n#| out-width: '100%'\n#| layout-nrow: 1\n#| column: page-inset-right\nlabs_fill_density <- labs(\n  title = \"Adult foraging penguins\",\n  x = \"Flipper length (millimeters)\", \n  fill = \"Sex\")\nggp2_fill_density <- ggplot(data = peng_density, \n       aes(x = flipper_length_mm, \n           after_stat(count),\n           fill = sex)) +\n      geom_density(position = \"fill\", \n                   alpha = 1/3) \nggp2_fill_density + \n  labs_fill_density\n```\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nThis results in a `y` axis ranging from 0-1, and the area filled with the relative proportional values.\n:::\n\n::::\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"show","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"arrow","toc":true,"toc-depth":5,"number-sections":true,"dpi":320,"output-file":"overlapping_stacked_density_plots.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","bibliography":["references.bib"],"theme":["cosmo","custom.scss"],"toc-location":"right","toc-title":"Contents","code-block-bg":"#f8f8f8","code-block-border-left":"#99bbc9","code-annotations":"hover","callout-appearance":"simple","code-summary":"show/hide","fig-asp":0.618,"fontsize":"1.085em","linestretch":1.25},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}