{
  "hash": "e94c89085318f245fc3d728716fa778e",
  "result": {
    "markdown": "# Diverging bar graphs {.unnumbered}\n\n\n\n\n\n::: {.callout-tip appearance='simple' icon=false}\n***This graph is largely complete and just needs final proof reading.*** \n:::\n\n\n\n:::: {.callout-note collapse=\"false\" icon=false}\n## Graph info\n::: {style=\"font-size: 1.25em; color: #007bff;\"}\n**Should I use this graph?**\n:::\n\n<br>\n\n\n::: {.cell layout-align=\"right\"}\n::: {.cell-output-display}\n![](diverging_bar_graphs_files/figure-html/full_code_display-1.png){fig-align='right' width=60% height=60%}\n:::\n:::\n\n\n::: {style=\"font-size: 1.10em; color: #007bff;\"}\n**This graph requires:**\n:::\n\n::: {style=\"font-size: 1.05em; color: #fa7b3c;\"}\n**✅ a categorical variable**      \n:::\n\n::: {style=\"font-size: 1.05em; color: #fa7b3c;\"}\n**✅ a numeric (continuous) variable**\n:::\n\n::::\n\n## Description\n\nIf you have two proportions that contain positive and negative values, consider using diverging bars with `geom_bar()`. \n\nUnlike a standard or stacked bar graphs, diverging bar graphs display positive and negative quantities on both sides of a reference or baseline value (zero in this example). Color, length and position are used to compare the quantities across categorical levels (and within variable values). \n\n:::: {.panel-tabset}\n\n### Horizontal bars\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](diverging_bar_graphs_files/figure-html/diverg-1.png){fig-align='center' width=75% height=75%}\n:::\n:::\n\n\n::: {style=\"font-size: 0.85em;\"}\nFor example, we can use the length of the bar from the reference line to compare disapproval estimates across all months (i.e., comparing red bars to each other). \n:::\n\n### Vertical bars\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](diverging_bar_graphs_files/figure-html/diverg_vert-1.png){fig-align='center' width=75% height=75%}\n:::\n:::\n\n\n::: {style=\"font-size: 0.85em;\"}\nWe can also compare approval vs. disapproval for each month (i.e., compare the blue vs. red bars to each other within each month).\n:::\n\n::::\n\n## Getting set up\n\n:::: {.panel-tabset}\n\n### Packages\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**PACKAGES:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nInstall packages.\n:::\n\n\n::: {style=\"font-size: 0.75em;\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\ninstall.packages(\"fivethirtyeight\")\nlibrary(fivethirtyeight) \nlibrary(ggplot2)\n```\n:::\n\n:::\n\n### Data\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**DATA:**\n:::\n\n::: {.column-margin}\n![](www/538.png){fig-align=\"right\" width=\"45%\" height=\"45%\"}\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nCreate `trump_approval_diverg` from the `trump_approval_trend` dataset in the `fivethirtyeight` package.\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nfivethirtyeight::trump_approval_trend |> \n  dplyr::filter(subgroup == \"All polls\") |> \n  dplyr::mutate(\n    month = lubridate::month(modeldate,\n                label = TRUE, abbr = TRUE),\n    approve = approve_estimate*0.01,\n    disapprove = disapprove_estimate*0.01,\n    disapprove = disapprove * -1) |> \n  tidyr::pivot_longer(cols = c(approve, disapprove), \n    names_to = \"poll\", values_to = \"values\") |> \n  dplyr::group_by(month, poll) |> \n    dplyr::summarise(\n      month_avg = mean(values, na.rm = TRUE)\n    ) |> \n  dplyr::ungroup() -> trump_approval_diverg\n#> `summarise()` has grouped output by 'month'. You can\n#> override using the `.groups` argument.\nglimpse(trump_approval_diverg)\n#> Rows: 24\n#> Columns: 3\n#> $ month     <ord> Jan, Jan, Feb, Feb, Mar, Mar, Apr, Apr, …\n#> $ poll      <chr> \"approve\", \"disapprove\", \"approve\", \"dis…\n#> $ month_avg <dbl> 0.4029758, -0.5234634, 0.4226055, -0.515…\n```\n:::\n\n:::\n::::\n\n## The grammar\n\n:::: {.panel-tabset}\n\n### Code\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**CODE:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\n\nCreate labels with `labs()`\n\nInitialize the graph with `ggplot()` and provide `data`\n\nMap the `month` to the `x` and `month_avg` to the `y`\n\nInside` geom_bar()`\n\n  - map `poll` to `fill`\n  \n  - use `stat = \"identity\"` and `width = .5`\n  \nAdd `scale_y_continuous()` to manually set the limits and format the axis with `scales::percent`\n\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nlabs_geom_bar_diverg <- labs(\n  title = \"Trump Approval Ratings\",\n  subtitle = \"From 'How Popular is Donald Trump'\",\n  x = \"Month\",\n  y = \"Monthly average percent\",\n  fill = \"Estimate\")\nggp2_bars_diverg <- ggplot(\n  data = trump_approval_diverg, \n    aes(x = month, y = month_avg)) +\n  geom_bar(aes(fill = poll),\n    stat = \"identity\", width = .5) + \n  scale_y_continuous(limits = c(-1, 1), \n    labels = scales::percent) \n\nggp2_bars_diverg + \n  labs_geom_bar_diverg\n```\n:::\n\n:::\n\n### Graph\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**GRAPH:**\n:::\n\n\n::: {.cell .column-page-inset-right layout-nrow=\"1\"}\n::: {.cell-output-display}\n![](diverging_bar_graphs_files/figure-html/create_graph_diverging_bar-1.png){width=100% height=100%}\n:::\n:::\n\n\n::::\n\n## More info\n\nFor vertically arranged bars, we switch the `x` and `y` axis variables.\n\n:::: {.panel-tabset}\n\n### Vertically arranged bars\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**Vertical bars:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\n\nCreate labels with `labs()`\n\nMap the `month_avg` to the `x` and `month` to the `y` \n\n*Inside* `geom_bar()` \n\n  - map `poll` to `fill`  \n\n  - use `stat = \"identity\"` and `width = .5`  \n  \nAdd `scale_y_continuous()` to manually set the limits and format the axis with `scales::percent` \n\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n\n\n::: {.cell .column-page-inset-right layout-nrow=\"1\"}\n\n```{.r .cell-code}\nlabs_geom_bar_diverg_vert <- labs(\n  title = \"Trump Approval Ratings\",\n  subtitle = \"From 'How Popular is Donald Trump'\",\n  x = \"Monthly average percent\",\n  y = \"Month\",\n  fill = \"Estimate\")\nggp2_bar_diverg_vert <- ggplot(\n  data = trump_approval_diverg,\n      aes(x = month_avg, y =  month)) +\n  geom_bar(\n      aes(fill = poll), \n        stat = \"identity\", width = .5) + \n  scale_x_continuous(limits = c(-1, 1), \n        labels = scales::percent)\nggp2_bar_diverg_vert + \n  labs_geom_bar_diverg_vert\n```\n\n::: {.cell-output-display}\n![](diverging_bar_graphs_files/figure-html/create_graph_vert_diverg_bars-1.png){width=100% height=100%}\n:::\n:::\n\n\n:::\n\n\n::::\n",
    "supporting": [
      "diverging_bar_graphs_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}