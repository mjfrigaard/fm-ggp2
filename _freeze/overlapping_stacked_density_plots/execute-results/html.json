{
  "hash": "9c4f97c40aca3655c1712131ef56c55e",
  "result": {
    "markdown": "# Overlapping density plot {.unnumbered}\n\n\n\n\n\n::: {.callout-tip appearance='simple' icon=false}\n***This graph is largely complete and just needs final proof reading.*** \n:::\n\n\n\n\n:::: {.callout-note collapse=\"false\" icon=false}\n\n::: {style=\"font-size: 1.25em; color: #02577A;\"}\nGraph info\n:::\n\n<br>\n\n\n::: {.cell layout-align=\"right\"}\n::: {.cell-output-display}\n![](overlapping_stacked_density_plots_files/figure-html/full_code_display-1.png){fig-align='right' width=60% height=60%}\n:::\n:::\n\n\n::: {style=\"font-size: 1.10em; color: #02577A;\"}\n**This graph requires:**\n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**✅ a categorical variable**      \n:::\n\n::: {style=\"font-size: 1.05em; color: #282b2d;\"}\n**✅ a numeric (continuous) variable**\n:::\n\n::::\n\n## Description \n\nDensity plots are [*smoothed version(s) of  histogram(s)*](https://ggplot2.tidyverse.org/reference/geom_density.html). They can are great for comparing the distributions of a continuous variable across the levels of a categorical variable. \n\n`geom_density()` creates a kernel density estimate. The default `position` argument is `\"identity\"`, which takes the data as is. However, we can change `position` to `\"stack\"` to display overlapping distributions.\n\n## Set up\n\n:::: {.panel-tabset}\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**PACKAGES:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nInstall packages.\n:::\n\n\n::: {style=\"font-size: 0.75em;\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\ninstall.packages(\"palmerpenguins\")\nlibrary(palmerpenguins)\nlibrary(ggplot2)\n```\n:::\n\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**DATA:**\n:::\n\n::: {.column-margin}\n![Artwork by allison horst](www/lter_penguins.png){fig-align=\"right\" width=\"100%\" height=\"100%\"}\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nRemove missing `sex` from the `penguins` data\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\npeng_density <- dplyr::filter(penguins, !is.na(sex))\ndplyr::glimpse(peng_density)\n#> Rows: 333\n#> Columns: 8\n#> $ species           <fct> Adelie, Adelie, Adelie, Adelie, …\n#> $ island            <fct> Torgersen, Torgersen, Torgersen,…\n#> $ bill_length_mm    <dbl> 39.1, 39.5, 40.3, 36.7, 39.3, 38…\n#> $ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, 19.3, 20.6, 17…\n#> $ flipper_length_mm <int> 181, 186, 195, 193, 190, 181, 19…\n#> $ body_mass_g       <int> 3750, 3800, 3250, 3450, 3650, 36…\n#> $ sex               <fct> male, female, female, female, ma…\n#> $ year              <int> 2007, 2007, 2007, 2007, 2007, 20…\n```\n:::\n\n:::\n::::\n\n## Grammar\n\n:::: {.panel-tabset}\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**CODE:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\n\nCreate labels with `labs()`\n\nInitialize the graph with `ggplot()` and provide `data`\n\nMap the `flipper_length_mm` to the `x` and `sex` to `fill` \n\nAdd the `geom_density()`  \n\nSet the `alpha` to `1/3` (to handle the overlapping areas)\n\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nlabs_ovrlp_density <- labs(\n  title = \"Adult foraging penguins\",\n  x = \"Flipper length (millimeters)\",\n  fill = \"Sex\")\nggp2_ovrlp_density <- ggplot(data = peng_density, \n       aes(x = flipper_length_mm, \n           fill = sex)) +\n      geom_density(alpha = 1/3) \nggp2_ovrlp_density + \n  labs_ovrlp_density\n```\n:::\n\n:::\n\n\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**GRAPH:**\n:::\n\n::: {.column-margin}\n*A downside of density plots is the lack of interpretability of the `y` axis*\n:::\n\n\n::: {style=\"font-size: 0.85em;\"}\nMake density area slightly transparent to handle over-plotting\n:::\n\n\n::: {.cell .column-page-inset-right layout-nrow=\"1\"}\n::: {.cell-output-display}\n![](overlapping_stacked_density_plots_files/figure-html/create_graph_ovrlp_density-1.png){width=100% height=100%}\n:::\n:::\n\n\n::::\n\n## More info\n\n`ggplot2` has multiple options for overlapping density plots, so which one to use will depend on how you'd like to display the relative distributions in your data. We'll cover three options below:\n\n:::: {.panel-tabset}\n\n### `\"stack\"`\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**STACK:**\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nIf we change the `position` to `\"stack\"` we can see the smoothed estimates are 'stacked' on top each other (and the `y` axis shifts slightly).\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n\n\n::: {.cell .column-page-inset-right layout-nrow=\"1\"}\n\n```{.r .cell-code}\nlabs_stack_density <- labs(\n    title = \"Adult foraging penguins\",\n    x = \"Flipper length (millimeters)\",\n    fill = \"Sex\")\nggp2_stack_density <- ggplot(data = peng_density,\n    mapping = aes(x = flipper_length_mm,\n               fill = sex)) +\n    geom_density(position = \"stack\",\n                 alpha = 1 / 3)\nggp2_stack_density +\n    labs_stack_density\n```\n\n::: {.cell-output-display}\n![](overlapping_stacked_density_plots_files/figure-html/code_graph_stack_density-1.png){width=100% height=100%}\n:::\n:::\n\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nSetting `position` to `'stack'` [loses marginal densities](https://ggplot2.tidyverse.org/reference/geom_density.html#ref-examples)\n:::\n\n### `after_stat(count)`\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**AFTER STAT:** \n:::\n\n::: {style=\"font-size: 0.85em;\"}\nIf we include `after_stat(count)` as one of our mapped aesthetics, the mapping is postponed until after statistical transformation, and uses the [*`density * n` instead of the default density*](https://ggplot2.tidyverse.org/reference/geom_density.html#computed-variables).\n:::\n\n::: {style=\"font-size: 0.75em;\"}\n\n::: {.cell .column-page-inset-right layout-nrow=\"1\"}\n\n```{.r .cell-code}\nlabs_after_stat_density <- labs(\n  title = \"Adult foraging penguins\",\n  x = \"Flipper length (millimeters)\", \n  fill = \"Sex\")\nggp2_after_stat_density <- ggplot(data = peng_density, \n       aes(x = flipper_length_mm, \n           after_stat(count),\n           fill = sex)) +\n      geom_density(position = \"stack\", \n                   alpha = 1/3) \nggp2_after_stat_density + \n  labs_after_stat_density\n```\n\n::: {.cell-output-display}\n![](overlapping_stacked_density_plots_files/figure-html/code_graph_after_stat_density-1.png){width=100% height=100%}\n:::\n:::\n\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nAdding [`after_stat(count)`](https://ggplot2.tidyverse.org/reference/geom_density.html#computed-variables) *'preserves marginal densities.'*, which result in more a interpretable `y` axis (depending on the audience)\n:::\n\n### `\"fill\"`\n\n::: {style=\"font-size: 1.15em; color: #1e83c8;\"}\n**FILL:** \n:::\n\n::: {style=\"font-size: 0.85em;\"}\nUsing `after_stat(count)` with `position = \"fill\"` creates in a conditional density estimate. \n:::\n\n\n::: {style=\"font-size: 0.75em;\"}\n\n::: {.cell .column-page-inset-right layout-nrow=\"1\"}\n\n```{.r .cell-code}\nlabs_fill_density <- labs(\n  title = \"Adult foraging penguins\",\n  x = \"Flipper length (millimeters)\", \n  fill = \"Sex\")\nggp2_fill_density <- ggplot(data = peng_density, \n       aes(x = flipper_length_mm, \n           after_stat(count),\n           fill = sex)) +\n      geom_density(position = \"fill\", \n                   alpha = 1/3) \nggp2_fill_density + \n  labs_fill_density\n```\n\n::: {.cell-output-display}\n![](overlapping_stacked_density_plots_files/figure-html/code_graph_fill_density-1.png){width=100% height=100%}\n:::\n:::\n\n:::\n\n::: {style=\"font-size: 0.85em;\"}\nThis results in a `y` axis ranging from 0-1, and the area filled with the relative proportional values.\n:::\n\n::::\n",
    "supporting": [
      "overlapping_stacked_density_plots_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}